FROM node:boron

COPY . /pivot-app

WORKDIR /pivot-app

ARG TEST_BUILD
ARG BUILD_NUMBER
ARG COMMIT_ID
ARG REV_NAME

COPY ./wholly-innocuous/files/npm/rc /root/.npmrc

RUN apt-get update && apt-get install -y jq

RUN npm install && \
    npm run build && \
    if [ ${TEST_BUILD} = false ]; then npm prune --production; fi

CMD npm start

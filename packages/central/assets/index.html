<html>
<head>
<link href="css/main.css" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Nunito:300' rel='stylesheet' type='text/css'>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>


var SUBTITLE = '<p><a href="mailto:info@graphistry.com">Email</a> us for a tool preview</p>';

var NETFLOW = {
    title: 'Datacenter Netflow Communication Logs',
    nodes: 'Pairs of <i>(IP,protocol)</i>',
    edges: 'Bandwidth from <span style="color:green">low</span> to <span style="color:red">high</span>',
    mapper: 'opentsdb'
};

var TITLES = {
    Facebook: {
        title: 'Facebook friendships',
        nodes: 'People. Color indicates community and size shows popularity.',
        edges: 'Friendships',
        mapper: 'opentsdb'
    },
    Miserables: {
        title: 'Characters Crossing Paths in Les Miserables',
        nodes: 'Characters. Color indicates community and size shows popularity.',
        edges: 'Characters co-occurred.',
        mapper: 'miserables'
    },
    NetflowSmall: NETFLOW,
    NetflowMedium: NETFLOW,
    NetflowLarge: NETFLOW,
    NetflowHuge: NETFLOW,
    Enron: {
        title: 'Enron emails',
        nodes: 'People. Color indicates community and size shows popularity.',
        edges: 'Indicates email exchanged'
    },
    Oregon: {
        title: 'Autonomous System Peering (Oregon)',
        nodes: '',
        edges: ''
    },
    Wikivotes: {
        title: 'Wikipedia Editor Elections',
        nodes: 'User',
        edges: 'Vote cast by one user for another'
    },
    Wikiriots: {
        title: 'Wikipedia Edits during Middle East riots Elections',
        nodes: 'Edits, Pages, Users, or Location',
        edges: 'Actions'
    },
    Amazon: {
        title: 'Amazon Product Co-Purchases',
        nodes: 'Product or a customer',
        edges: 'Product reviewd by a customer'
    },
    Gnutella: {
        title: 'Gnutella Peer-to-Peer Network',
        nodes: 'Hosts (computers)',
        edges: 'Communications'
    },
    Epinions: {
        title: 'Epinions Trust Relationships',
        nodes: 'Users',
        edges: 'Trust relationship'
    },
    Twitter: {
        title: 'Criminal Twitter Botnet',
        subtitle: [
            '<p><i>Analysis by Graphistry, Inc. on 3/18/2015</i>.</p>',
            '<p>The botnet (top layer), ',
            'launders Twitter retweets through an indirection layer (middle) ',
            'in order to build social rank for fraudsters (bottom). ',
            'Twitter\'s core targeting algorithm then routes the artificially trending tweets ',
            'to potential victims in the precise demographic of FIFA/Madden gamers.</p>',
            '<p>Many victims have been tricked into revealing their credit cards and passports.</p>'
        ].join(' '),
        nodes: 'Twitter accounts',
        edges: 'Follow relationship'
    },
    Biogrid: {
        title: 'BioGRID Repository of Protein Interactions',
        subtitle: '<p>Each color represents an organism. Humans are in light blue.</p>',
        nodes: 'Proteins/Genes',
        edges: 'Interactions reported in scientific publications',
    },
};
for (var i in TITLES) {
    var o = TITLES[i];
    o.title ='<h3>' + o.title + '</h3>';
}

function getURL(dataset) {
    var cfg = TITLES[dataset]  || {
            title: '<h3>Graph: ' + dataset + '</h3>',
            nodes: 'undefined',
            edges: 'undefined'
        };
    cfg.mapper = cfg.mapper || 'splunk';
    cfg.subtitle = cfg.subtitle || SUBTITLE;


    var controls = $('#controls').val();
    var legend = {title: cfg.title, subtitle: cfg.subtitle,
                  nodes: cfg.nodes, edges: cfg.edges};

    var args = [
        'dataset=' + encodeURIComponent(dataset),
        //'controls=' + controls,
        'scene=' + (controls === 'uber' ? 'uber' : 'default'),
        'info=true',
        'play=10000',
        'mapper=' + cfg.mapper,
        'legend=' + encodeURIComponent(JSON.stringify(legend)),
    ];

    return '/graph/graph.html?' + args.join('&');
}

function jump() {
    var dataset = $('#dataset').val();
    var url = getURL(dataset);
    window.open(url, '_blank');
}

function mkLinks() {
    $('.dataset-link').each(function () {
        console.log(this);
        var dataset = $(this).data('dataset');
        console.log(dataset)
        $(this).attr('href', getURL(dataset))
    });
}

function ping(k) {
    console.log('go');
    var t0 = Date.now();

    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'mt.html', true);
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
            k(Date.now() - t0);
        }
    };
    xhr.send(null);
}

function pinger () {
    var timings = [];
    var loop = function (step) {
        if (step) {
            ping(function (v) {
                timings.push(v);
                loop(step - 1);
            });
        } else {
            var sum = 0;
            for (var i = 0; i < timings.length; i++) {
                sum += timings[i];
            }
            document.getElementById('ping').innerHTML =
                '<i>ping: ' + (sum/timings.length).toFixed(1) + 'ms rtt</i>';
        }
    };
    loop(10);
}

$(document).ready(function () {
    pinger();
    mkLinks();
});
</script>


</head>
<body>

<div class="banner">
    <img src="img/logo.png" style="width: 300px;" />
    <div style="font-size:0.5em; font-weight: bold">LABS DEMOS</div>

    <div style="font-size:0.5em">
        <a href="mailto:info@graphistry.com">email</a> for tool preview
    </div>
</div>

<div class="content">
    <div class="regions">
        <div class="off">
            <span class="name">nyc</span>
            <span class="status">offline</span>
        </div>
        <div class="cali">
            <b>california</b>
            <div style="font-size: 0.5em; padding-top: 0.3em; text-align: center; line-height: 1.8em">
            <!--
                <a href="graph/uber.html?dataset=Uber&type=OBSOLETE_geo&scene=uber&controls=uber&info=true">uber</a>
            -->
                <a class="dataset-link" data-dataset="NetflowLarge">netflow logs</a> (<a class="dataset-link" data-dataset="NetflowHuge">huge: 2min</a>)

                <br/>
                <a class="dataset-link" data-dataset="Twitter">twitter criminal botnet</a>

                <br/>
                <a class="dataset-link" data-dataset="Facebook"> facebook friendships </a>

                <div id="ping" style="position: absolute; padding-left: 6em; padding-top: 0.2em; font-size: 0.8em"></div>
            </div>

        </div>
        <div class="off">
            <span class="name">tokyo</span>
            <span class="status">offline</span>
        </div>
        <div class="off">
            <span class="name">singapore</span>
            <span class="status">offline</span>
        </div>
    </div>

    <div class="loader">
        <h3>+ experimental datasets</h3>
        <span>
            <input id="dataset" list="datasets" type="text" size="64" name="url" value="Miserables" />
            <datalist id="datasets">
                <option value="Amazon">
                <option value="Biogrid">
                <option value="Enron">
                <option value="Epinions">
                <option value="Facebook">
                <option value="Gnutella">
                <option value="Miserables">
                <option value="NetflowSmall">
                <option value="NetflowMedium">
                <option value="NetflowLarge">
                <option value="NetflowHuge">
                <option value="Oregon">
                <option value="Twitter">
                <option value="Wikivotes">
                <option value="Wikiriots">
            </datalist>
        </span>
        <!--
        <span> layout:
            <select id="controls" >
                <option value="atlas">Force Atlas 2</option>
                <option value="gauss">Gauss-Seidel</option>
                <option value="uber">Edge Bundling</option>
            </select>
        </span>
        -->
        <button type="button" onclick="jump();">go</button>
    </div>
</div>

</body>
</html>

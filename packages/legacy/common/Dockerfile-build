FROM node:alpine

WORKDIR /app

COPY ./wholly-innocuous/files/npm/rc /root/.npmrc
COPY ./common .

ARG BUILD_NUMBER
RUN apk add --no-cache jq
RUN mv package.json package.json.old
RUN jq . < package.json.old | sed -E -e 's/("version": "[0-9]+[.][0-9]+[.])[^"]+/\1'${BUILD_NUMBER}/ > package.json

RUN npm install
RUN npm publish

FROM node:8.4.0-alpine

RUN apk add --no-cache git

ARG TARGET_REF=master
ENV TARGET_REF $TARGET_REF

WORKDIR /graphistry

COPY ./.git .git
COPY ./packages packages
COPY ./lerna.json ./package.json ./

RUN npm i -g lerna

CMD ["sh", "-c", "lerna exec --loglevel=error -- echo \${PWD##*/}"]